<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Fundaci칩n APASCOVI 췅 Encuesta de satisfacci칩n</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    :root{
      --bg:#0f172a;
      --card:#ffffff;
      --border:#e5e7eb;
      --text:#020617;
      --muted:#64748b;
      --accent:#22c55e;
      --accent-dark:#16a34a;
    }

    *{box-sizing:border-box;}

    html, body{
      margin:0;
      padding:0;
    }

    body{
      background:var(--bg);
      color:var(--text);
      font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif;
    }

    .shell{
      width:100%;
      max-width:1100px;
      margin:0 auto;
      padding:8px;
    }

    .card{
      background:var(--card);
      border-radius:18px;
      border:1px solid #1f2937;
      box-shadow:0 10px 30px rgba(0,0,0,.25);
      display:flex;
      flex-direction:column;
      min-height:0;
    }

    header{
      padding:18px 22px;
      background:#020617;
      color:#e5e7eb;
      display:flex;
      flex-wrap:wrap;
      justify-content:flex-start;
      align-items:center;
      gap:12px;
    }

    .header-main{
      display:flex;
      align-items:center;
      gap:12px;
    }

    header h1{
      margin:0;
      font-size:1.8rem;
    }

    header p{
      margin:4px 0 0;
      font-size:1.05rem;
      color:#cbd5f5;
    }

    .body{
      padding:18px 22px 20px;
      background:#f8fafc;
      font-size:1.05rem;
    }

    .notice{
      background:#e0f2fe;
      border-left:4px solid #0284c7;
      padding:12px 14px;
      border-radius:12px;
      color:#0f172a;
      font-size:1.05rem;
      margin-bottom:18px;
    }

    fieldset{
      border:none;
      margin:0 0 16px;
      padding:0;
    }

    legend{
      font-weight:700;
      margin-bottom:10px;
      font-size:1.15rem;
    }

    .grid-2{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:12px 18px;
    }

    @media(max-width:800px){
      .grid-2{grid-template-columns:1fr;}
    }

    label{
      font-size:1rem;
      display:block;
      margin-bottom:4px;
      color:#0f172a;
    }

    input[type="text"],
    input[type="number"],
    input[type="date"],
    textarea{
      width:100%;
      padding:10px 11px;
      border-radius:10px;
      border:1px solid var(--border);
      font-size:1rem;
    }

    textarea{
      min-height:90px;
      resize:vertical;
    }

    .block-title{
      margin:18px 0 6px;
      font-weight:800;
      font-size:1.25rem;
      text-transform:uppercase;
      color:#0f172a;
    }

    .block-desc{
      margin:0 0 10px;
      font-size:1rem;
      color:var(--muted);
    }

    /* Bloques de pregunta */

    .question-block{
      background:#ffffff;
      border-radius:16px;
      border:1px solid #e2e8f0;
      padding:14px 12px 18px;
      margin-bottom:12px;
    }

    .pictos-row{
      display:flex;
      flex-wrap:wrap;
      gap:18px;
      margin-bottom:10px;
      align-items:center;
      justify-content:flex-start;
    }

    .pictos-row img{
      width:135px;
      height:135px;
      border:3px solid #000;
      border-radius:8px;
      object-fit:contain;
      background:#ffffff;
      display:block;
    }

    .question-header{
      display:flex;
      align-items:center;
      gap:8px;
      margin-bottom:12px;
    }

    .question-number{
      font-weight:700;
      font-size:1.3rem;
    }

    .question-text{
      margin:0;
      font-size:1.25rem;
      line-height:1.4;
      flex:1;
    }

    .listen-button{
      margin-left:auto;
      border:none;
      border-radius:999px;
      background:#e5e7eb;
      color:#0f172a;
      padding:10px 16px;
      font-size:1rem;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:6px;
      white-space:nowrap;
    }

    .listen-button span.icon{
      font-size:1.1rem;
    }

    .listen-button:hover{
      background:#cbd5f5;
    }

    .listen-button:focus{
      outline:2px solid #2563eb;
      outline-offset:1px;
    }

    .answers-row{
      display:flex;
      flex-wrap:wrap;
      gap:40px;
      margin-top:10px;
      align-items:flex-start;
      justify-content:flex-start;
    }

    .answer-option{
      display:flex;
      flex-direction:column;
      align-items:center;
      cursor:pointer;
      touch-action:manipulation;
      user-select:none;
    }

    .answer-face{
      width:84px;
      height:84px;
      border-radius:999px;
      border:5px solid #e5e7eb;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:40px;
      background:#ffffff;
      transition:.1s transform,.1s box-shadow,.1s border-color,.1s background-color;
    }

    .answer-option[data-value="NO"] .answer-face{
      border-color:#f97373;
      color:#b91c1c;
    }

    .answer-option[data-value="A VECES"] .answer-face{
      border-color:#facc15;
      color:#92400e;
    }

    .answer-option[data-value="SI"] .answer-face{
      border-color:#4ade80;
      color:#166534;
    }

    /* Selecci칩n: c칤rculo rojo exterior */
    .answer-option.selected .answer-face{
      box-shadow:0 0 0 6px rgba(220,38,38,0.8); /* rojo alrededor */
      transform:translateY(-2px) scale(1.04);
    }

    .answer-option:hover .answer-face{
      transform:translateY(-1px);
    }

    .answer-caption{
      margin-top:6px;
      font-size:1rem;
      font-weight:700;
      text-transform:uppercase;
      text-align:center;
    }

    footer{
      padding:12px 18px;
      background:#020617;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:8px;
      flex-wrap:wrap;
    }

    .btn{
      border:none;
      border-radius:999px;
      padding:10px 18px;
      font-size:1rem;
      font-weight:700;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:6px;
      touch-action:manipulation;
    }

    .btn-primary{
      background:var(--accent);
      color:#022c22;
    }

    .btn-primary:hover{background:var(--accent-dark);}

    .btn-secondary{
      background:#1f2937;
      color:#e5e7eb;
    }

    .btn-secondary:hover{background:#111827;}

    .status{
      font-size:.9rem;
      color:#e5e7eb;
      min-height:1.2em;
    }

    @media(max-width:800px){
      .body{padding:14px 14px 16px;}
      .pictos-row img{
        width:110px;
        height:110px;
      }
      .question-text{
        font-size:1.15rem;
      }
      .answers-row{gap:24px;}
      .answer-face{
        width:72px;
        height:72px;
        font-size:32px;
      }
    }

    @media print{
      body{background:#ffffff;}
      .shell{max-width:100%;padding:0;margin:0;}
      .card{box-shadow:none;border:none;border-radius:0;}
      footer{display:none;}
      .listen-button{display:none;}
    }
  </style>
</head>
<body>
<div class="shell">
  <div class="card">
    <header>
      <div class="header-main">
        <div>
          <h1>Fundaci칩n APASCOVI: Tu satisfacci칩n nos importa.</h1>
          <p>Encuesta de satisfacci칩n para personas usuarias del centro / servicio</p>
        </div>
      </div>
    </header>

    <div class="body">
      <div class="notice">
        Mira los dibujos, lee la pregunta y elige <strong>NO</strong>, <strong>A VECES</strong> o <strong>S칈</strong>.
      </div>

      <form id="surveyForm">
        <!-- DATOS GENERALES -->
        <fieldset>
          <legend>Datos generales</legend>
          <div class="grid-2">
            <div>
              <label for="centro">Nombre del centro</label>
              <input type="text" id="centro" name="centro">
            </div>
            <div>
              <label for="codigo">Iniciales / c칩digo (opcional)</label>
              <input type="text" id="codigo" name="codigo">
            </div>
            <div>
              <label for="antY">A침os que llevas en el centro</label>
              <input type="number" id="antY" name="antY" min="0">
            </div>
            <div>
              <label for="antM">Meses que llevas en el centro</label>
              <input type="number" id="antM" name="antM" min="0" max="11">
            </div>
            <div>
              <label for="fecha">Fecha</label>
              <input type="date" id="fecha" name="fecha">
            </div>
          </div>
        </fieldset>

        <div class="block-title">
          ENTORNO F칈SICO: LAS INSTALACIONES DEL CENTRO Y SU ENTORNO
        </div>
        <div class="block-desc">
          Responde pensando en c칩mo es tu centro en el d칤a a d칤a.
        </div>

        <!-- PREGUNTA 1 -->
        <section class="question-block" data-question="1">
          <div class="pictos-row">
            <img src="img/1.a.png" alt="Sala de estar del centro">
            <img src="img/1.b.png" alt="Comedor del centro">
            <img src="img/1.c.png" alt="Persona viendo la televisi칩n">
          </div>

          <div class="question-header">
            <span class="question-number">1.</span>
            <p class="question-text">
              쯃as zonas comunes y muebles que hay en tu centro son c칩modos?
            </p>
            <button type="button" class="listen-button" onclick="playQuestion(1)">
              <span class="icon">游댉</span> Escuchar
            </button>
          </div>

          <div class="answers-row">
            <div class="answer-option" data-value="NO" onclick="selectAnswer(1, 'NO', this)">
              <div class="answer-face">游뗴</div>
              <div class="answer-caption">NO</div>
            </div>
            <div class="answer-option" data-value="A VECES" onclick="selectAnswer(1, 'A VECES', this)">
              <div class="answer-face">游땛</div>
              <div class="answer-caption">A VECES</div>
            </div>
            <div class="answer-option" data-value="SI" onclick="selectAnswer(1, 'SI', this)">
              <div class="answer-face">游뗵</div>
              <div class="answer-caption">S칈</div>
            </div>
          </div>
        </section>

        <!-- PREGUNTA 2 -->
        <section class="question-block" data-question="2">
          <div class="pictos-row">
            <img src="img/2.a.png" alt="Persona caminando por el centro">
            <img src="img/2.b.png" alt="Persona tropezando con un obst치culo">
            <img src="img/2.c.png" alt="Zona del centro con muchos objetos en el suelo">
          </div>

          <div class="question-header">
            <span class="question-number">2.</span>
            <p class="question-text">
              쯊e puedes mover por tu centro de forma f치cil y sin obst치culos?
            </p>
            <button type="button" class="listen-button" onclick="playQuestion(2)">
              <span class="icon">游댉</span> Escuchar
            </button>
          </div>

          <div class="answers-row">
            <div class="answer-option" data-value="NO" onclick="selectAnswer(2, 'NO', this)">
              <div class="answer-face">游뗴</div>
              <div class="answer-caption">NO</div>
            </div>
            <div class="answer-option" data-value="A VECES" onclick="selectAnswer(2, 'A VECES', this)">
              <div class="answer-face">游땛</div>
              <div class="answer-caption">A VECES</div>
            </div>
            <div class="answer-option" data-value="SI" onclick="selectAnswer(2, 'SI', this)">
              <div class="answer-face">游뗵</div>
              <div class="answer-caption">S칈</div>
            </div>
          </div>
        </section>

        <!-- PREGUNTA 3 -->
        <section class="question-block" data-question="3">
          <div class="pictos-row">
            <img src="img/3.a.png" alt="Productos de limpieza del centro">
            <img src="img/3.b.png" alt="Trabajadora de limpieza del centro">
            <img src="img/3.c.png" alt="Personas realizando tareas del hogar">
            <img src="img/3.d.png" alt="Persona de mantenimiento y reparaciones">
          </div>

          <div class="question-header">
            <span class="question-number">3.</span>
            <p class="question-text">
              쯊e gusta c칩mo limpian y cuidan el centro?
            </p>
            <button type="button" class="listen-button" onclick="playQuestion(3)">
              <span class="icon">游댉</span> Escuchar
            </button>
          </div>

          <div class="answers-row">
            <div class="answer-option" data-value="NO" onclick="selectAnswer(3, 'NO', this)">
              <div class="answer-face">游뗴</div>
              <div class="answer-caption">NO</div>
            </div>
            <div class="answer-option" data-value="A VECES" onclick="selectAnswer(3, 'A VECES', this)">
              <div class="answer-face">游땛</div>
              <div class="answer-caption">A VECES</div>
            </div>
            <div class="answer-option" data-value="SI" onclick="selectAnswer(3, 'SI', this)">
              <div class="answer-face">游뗵</div>
              <div class="answer-caption">S칈</div>
            </div>
          </div>
        </section>

        <!-- PREGUNTA 4 -->
        <section class="question-block" data-question="4">
          <div class="pictos-row">
            <img src="img/4.a.png" alt="Puerta con rampa accesible">
            <img src="img/4.b.png" alt="Persona en silla de ruedas en el transporte">
          </div>

          <div class="question-header">
            <span class="question-number">4.</span>
            <p class="question-text">
              쮼l transporte para ir al centro y volver a casa es c칩modo y adecuado para ti?
            </p>
            <button type="button" class="listen-button" onclick="playQuestion(4)">
              <span class="icon">游댉</span> Escuchar
            </button>
          </div>

          <div class="answers-row">
            <div class="answer-option" data-value="NO" onclick="selectAnswer(4, 'NO', this)">
              <div class="answer-face">游뗴</div>
              <div class="answer-caption">NO</div>
            </div>
            <div class="answer-option" data-value="A VECES" onclick="selectAnswer(4, 'A VECES', this)">
              <div class="answer-face">游땛</div>
              <div class="answer-caption">A VECES</div>
            </div>
            <div class="answer-option" data-value="SI" onclick="selectAnswer(4, 'SI', this)">
              <div class="answer-face">游뗵</div>
              <div class="answer-caption">S칈</div>
            </div>
          </div>
        </section>

        <!-- PREGUNTA 5 -->
        <section class="question-block" data-question="5">
          <div class="pictos-row">
            <img src="img/5.a.png" alt="Dos manos que piden ayuda">
            <img src="img/5.b.png" alt="Persona con dolor y malestar">
            <img src="img/5.c.png" alt="Persona que se cae">
          </div>

          <div class="question-header">
            <span class="question-number">5.</span>
            <p class="question-text">
              Cuando tienes un problema, 쯟os profesionales del centro te atienden r치pido?
            </p>
            <button type="button" class="listen-button" onclick="playQuestion(5)">
              <span class="icon">游댉</span> Escuchar
            </button>
          </div>

          <div class="answers-row">
            <div class="answer-option" data-value="NO" onclick="selectAnswer(5, 'NO', this)">
              <div class="answer-face">游뗴</div>
              <div class="answer-caption">NO</div>
            </div>
            <div class="answer-option" data-value="A VECES" onclick="selectAnswer(5, 'A VECES', this)">
              <div class="answer-face">游땛</div>
              <div class="answer-caption">A VECES</div>
            </div>
            <div class="answer-option" data-value="SI" onclick="selectAnswer(5, 'SI', this)">
              <div class="answer-face">游뗵</div>
              <div class="answer-caption">S칈</div>
            </div>
          </div>
        </section>

        <!-- PREGUNTA 6 -->
        <section class="question-block" data-question="6">
          <div class="pictos-row">
            <img src="img/6.a.png" alt="Persona que pide m치s ayuda o atenci칩n">
            <img src="img/6.b.png" alt="Profesional tomando el pulso">
            <img src="img/6.c.png" alt="Persona hablando con un profesional">
          </div>

          <div class="question-header">
            <span class="question-number">6.</span>
            <p class="question-text">
              쯃a atenci칩n y los cuidados que recibes cubren bien tus necesidades?
            </p>
            <button type="button" class="listen-button" onclick="playQuestion(6)">
              <span class="icon">游댉</span> Escuchar
            </button>
          </div>

          <div class="answers-row">
            <div class="answer-option" data-value="NO" onclick="selectAnswer(6, 'NO', this)">
              <div class="answer-face">游뗴</div>
              <div class="answer-caption">NO</div>
            </div>
            <div class="answer-option" data-value="A VECES" onclick="selectAnswer(6, 'A VECES', this)">
              <div class="answer-face">游땛</div>
              <div class="answer-caption">A VECES</div>
            </div>
            <div class="answer-option" data-value="SI" onclick="selectAnswer(6, 'SI', this)">
              <div class="answer-face">游뗵</div>
              <div class="answer-caption">S칈</div>
            </div>
          </div>
        </section>
      </form>
    </div>

    <footer>
      <div class="status" id="statusText"></div>
      <div>
        <button type="button" class="btn btn-secondary" onclick="window.print()">
          游 Descargar en PDF
        </button>
        <button type="button" class="btn btn-primary" onclick="downloadCSV()">
          游늵 Anal칤ticas (CSV)
        </button>
      </div>
    </footer>
  </div>
</div>

<script>
  // Textos de las preguntas para la locuci칩n.
  // Solo leen la pregunta, con buena entonaci칩n interrogativa.
  const questionTexts = {
    1: "Pregunta 1. 쯃as zonas comunes y muebles que hay en tu centro son c칩modos?",
    2: "Pregunta 2. 쯊e puedes mover por tu centro de forma f치cil y sin obst치culos?",
    3: "Pregunta 3. 쯊e gusta c칩mo limpian y cuidan el centro?",
    4: "Pregunta 4. 쮼l transporte para ir al centro y volver a casa es c칩modo y adecuado para ti?",
    5: "Pregunta 5. Cuando tienes un problema, 쯟os profesionales del centro te atienden r치pido?",
    6: "Pregunta 6. 쯃a atenci칩n y los cuidados que recibes cubren bien tus necesidades?"
  };

  let audioTimeoutId = null;

  function playQuestion(num){
    const text = questionTexts[num];
    if (!text) return;

    if (!("speechSynthesis" in window)) {
      alert("Tu navegador no puede leer en voz alta.");
      return;
    }

    const synth = window.speechSynthesis;

    // Parar cualquier lectura anterior y cancelar retrasos previos
    synth.cancel();
    if (audioTimeoutId) {
      clearTimeout(audioTimeoutId);
    }

    // Espera de unos 4 segundos antes de empezar a hablar
    const delayMs = 4000;
    audioTimeoutId = setTimeout(() => {
      const utterance = new SpeechSynthesisUtterance(text);
      utterance.lang = "es-ES";
      utterance.rate = 0.8; // m치s lento
      synth.speak(utterance);
    }, delayMs);
  }

  function selectAnswer(questionNumber, value, element){
    const block = document.querySelector(
      `section.question-block[data-question="${questionNumber}"]`
    );
    if (!block) return;

    block.querySelectorAll(".answer-option").forEach((opt) => {
      opt.classList.remove("selected");
    });

    element.classList.add("selected");
    block.dataset.answer = value;
  }

  function getAnswers(){
    const blocks = Array.from(document.querySelectorAll(".question-block"));
    const answers = {};
    blocks.forEach((block) => {
      const q = block.dataset.question;
      answers[q] = block.dataset.answer || "";
    });
    return answers;
  }

  function downloadCSV(){
    const form = document.getElementById("surveyForm");

    const centro = (form.centro?.value || "").trim();
    const codigo = (form.codigo?.value || "").trim();
    const antY = (form.antY?.value || "").trim();
    const antM = (form.antM?.value || "").trim();
    const fecha = (form.fecha?.value || "").trim();

    const answers = getAnswers();
    const questions = Object.keys(answers).sort(
      (a, b) => parseInt(a) - parseInt(b)
    );

    // Peque침a advertencia si falta alguna respuesta
    const missing = questions.filter((q) => !answers[q]);
    if (missing.length > 0) {
      const seguir = confirm(
        "A칰n hay preguntas sin contestar (" +
        missing.join(", ") +
        "). 쯈uieres descargar igualmente el archivo con las respuestas que tienes?"
      );
      if (!seguir) return;
    }

    // Cabecera CSV
    const headerParts = [
      "Centro",
      "Codigo",
      "Antiguedad_anios",
      "Antiguedad_meses",
      "Fecha"
    ];
    questions.forEach((q) => headerParts.push("P" + q));

    const header = headerParts.join(";");

    // Fila de datos
    const rowParts = [
      centro,
      codigo,
      antY,
      antM,
      fecha
    ];
    questions.forEach((q) => rowParts.push(answers[q] || ""));

    const row = rowParts.join(";");

    const csvContent = header + "\n" + row + "\n";
    const blob = new Blob([csvContent], {
      type: "text/csv;charset=utf-8;"
    });
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = "encuesta_analiticas.csv";
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
  }
</script>
</body>
</html>